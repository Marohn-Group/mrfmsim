import numpy as np
import numba as nb
from scipy.special import elliprf, ellipk, elliprj, ellipe
from dataclasses import dataclass, field
from mrfmsim.component import ComponentBase


@dataclass
class CylinderMagnet(ComponentBase):
    """Cylinder magnet object with its Bz, Bzx, Bzxx calculations.

    :param float radius: cylinder magnet radius [nm] !!!There would ba a singularity 
    when x^2+y^2=R^2, so set a small difference to R! Also when x^2+y^2=0, B_zxx would 
    run into a singularity, try to avoid this point.
    :param float length: cylinder magnet length [nm]
    :param tuple origin: the position of the magnet origin (x, y, z)
    :param float mu0_Ms: saturation magnetization [mT]
    """

    magnet_radius: float = field(metadata={"unit": "nm", "format": ".1f"})
    magnet_length: float = field(metadata={"unit": "nm", "format": ".1f"})
    magnet_origin: tuple[float, float, float] = field(
        metadata={"unit": "nm", "format": ".1f"}
    )
    mu0_Ms: float = field(metadata={"unit": "mT"})

    def Bz_method(self, x, y, z):
        r"""Calculate magnetic field :math:`B_z` [mT].

                The magnetic field is calculated as

        .. math::
            Bz = mu0_Ms * (P21 * alpha1 * eps1 - P22 * eps2 * alpha2) * R / (r + R) / pi

        in which:
            eps1 = z + L/2
            eps2 = z - L/2
            k1 = (eps1**2 + (r - R) ** 2) / (eps1**2 + (r + R) ** 2)
            k2 = (eps2**2 + (r - R) ** 2) / (eps2**2 + (r + R) ** 2)
            g = (r - R) / (r + R)
            n = 1 - g**2
            alpha1 = 1 / \sqrt{eps1**2 + (r + R) ** 2}
            alpha2 = 1 / \sqrt{eps2**2 + (r + R) ** 2}
            P21 = -g / (1 - g**2) * (elliptic_pi(n, 1 - k1) - elliptic_k(1 - k1)) - 1 
            / (1 - g**2 ) * (g**2 * elliptic_pi(n, 1 - k1) - elliptic_k(1 - k1))
            P22 = -g / (1 - g**2) * (elliptic_pi(n, 1 - k2) - elliptic_k(1 - k2)) - 1 
            / (1 - g**2 ) * (g**2 * elliptic_pi(n, 1 - k2) - elliptic_k(1 - k2))
        note that:
            the def of n (in elliptic integral) is different in the paper and the code,
            so we need to change the def of n in the code.

        :param float x: x coordinate of sample grid [nm]
        :param float y: y coordinate of sample grid [nm]
        :param float z: z coordinate of sample grid [nm]


        Here :math:`(x,y,z)` is the location at which we want to know the field;
        :math:`r` is the radius of the magnet; :math:`r**2 = x**2 + y**2`;
        :math 'dx = x-x_0'
        :math 'dy = y-y_0'
        :math 'dz = z-z_0'
        distances to the center of the magnet;
        :math:`\mu_0 M_s` is the magnetic sphere's saturation
        magnetization in mT.

        There is a singularity when x^2+y^2==0, so we need to manually replace B_z with 
        its corresponding algebraic form:

        .. math::
            Bz = \dfrac{\mu0_Ms}{2} * \dfrac{z + L/2}{\sqrt{(z + L/2)**2 + R**2}} - 
            \dfrac{\mu0_Ms}{2} * \dfrac{z - L/2}{\sqrt{(z - L/2)**2 + R**2}}
        """

        def ellipiticPi(n, m):
            return elliprf(0.0, 1.0 - m, 1.0) + (n / 3.0) * elliprj(
                0.0, 1.0 - m, 1.0, 1.0 - n
            )

        dr = np.sqrt(
            (x - self.magnet_origin[0]) ** 2 + (y - self.magnet_origin[1]) ** 2
        )
        dz = z - self.magnet_origin[2]
        g = (dr - self.magnet_radius) / (dr + self.magnet_radius)
        eps1 = dz + self.magnet_length / 2
        eps2 = dz - self.magnet_length / 2
        k1 = (eps1**2 + (dr - self.magnet_radius) ** 2) / (
            eps1**2 + (dr + self.magnet_radius) ** 2
        )
        k2 = (eps2**2 + (dr - self.magnet_radius) ** 2) / (
            eps2**2 + (dr + self.magnet_radius) ** 2
        )
        n = 1 - g**2

        ep11 = ellipk(1 - k1)
        ep21 = ellipe(1 - k1)
        ep31 = ellipiticPi(n, 1 - k1)

        ep12 = ellipk(1 - k2)
        ep22 = ellipe(1 - k2)
        ep32 = ellipiticPi(n, 1 - k2)

        zero_coords = np.argwhere(dr == 0)

        if zero_coords.size > 0:
            dr[zero_coords[0][0]][zero_coords[0][1]][zero_coords[0][2]] = np.nan
            BZ = self.mu0_Ms * self._Bz_np(
                r=dr,
                Z=dz,
                ep11=ep11,
                ep21=ep21,
                ep31=ep31,
                ep12=ep12,
                ep22=ep22,
                ep32=ep32,
            )
            BZ[zero_coords[0][0]][zero_coords[0][1]][:] = (
                self.mu0_Ms
                / 2
                * (
                    (dz + self.magnet_length / 2)
                    / np.sqrt(
                        (dz + self.magnet_length / 2) ** 2 + (self.magnet_radius) ** 2
                    )
                    - (dz - self.magnet_length / 2)
                    / np.sqrt(
                        (dz - self.magnet_length / 2) ** 2 + (self.magnet_radius) ** 2
                    )
                )
            )
            return BZ

        else:
            return self.mu0_Ms * self._Bz_np(
                r=dr,
                Z=dz,
                ep11=ep11,
                ep21=ep21,
                ep31=ep31,
                ep12=ep12,
                ep22=ep22,
                ep32=ep32,
            )

    def Bzx_method(self, x, y, z):
        r"""Calculate magnetic field :math:`B_z` [mT].

                The magnetic field is calculated as

        .. math:
            \dfrac{\partial B_z}{\partial x} = \dfrac{\partial B_z}{\partial r} * 
            \dfrac{\partial r}{\partial x}+\dfrac{\partial B_z}{\partial z} * 
            \dfrac{\partial z}{\partial x}
            =\dfrac{\partial B_z}{\partial r} * \dfrac{x}{r}

        :param float x: x coordinate of sample grid [nm]
        :param float y: y coordinate of sample grid [nm]
        :param float z: z coordinate of sample grid [nm]

        Here :math:`(x,y,z)` is the location at which we want to know the field;
        :math:`r` is the radius of the magnet; :math:`r**2 = x**2 + y**2`;
        :math 'dx = x-x_0'
        :math 'dy = y-y_0'
        :math 'dz = z-z_0'
        distances to the center of the magnet;
        :math:`\mu_0 M_s` is the magnetic sphere's saturation
        magnetization in mT.
        """

        def ellipiticPi(n, m):
            return elliprf(0.0, 1.0 - m, 1.0) + (n / 3.0) * elliprj(
                0.0, 1.0 - m, 1.0, 1.0 - n
            )

        dr = np.sqrt(
            (x - self.magnet_origin[0]) ** 2 + (y - self.magnet_origin[1]) ** 2
        )
        dz = z - self.magnet_origin[2]
        zero_coords = np.argwhere(dr == 0)

        g = (dr - self.magnet_radius) / (dr + self.magnet_radius)
        eps1 = dz + self.magnet_length / 2
        eps2 = dz - self.magnet_length / 2
        k1 = (eps1**2 + (dr - self.magnet_radius) ** 2) / (
            eps1**2 + (dr + self.magnet_radius) ** 2
        )
        k2 = (eps2**2 + (dr - self.magnet_radius) ** 2) / (
            eps2**2 + (dr + self.magnet_radius) ** 2
        )
        n = 1 - g**2

        ep11 = ellipk(1 - k1)
        ep21 = ellipe(1 - k1)
        ep31 = ellipiticPi(n, 1 - k1)

        ep12 = ellipk(1 - k2)
        ep22 = ellipe(1 - k2)
        ep32 = ellipiticPi(n, 1 - k2)

        if zero_coords.size > 0:
            dr[zero_coords[0][0]][zero_coords[0][1]][zero_coords[0][2]] = np.nan
            BZr = (
                self.mu0_Ms
                * self._Bzr_np(
                    r=dr,
                    Z=dz,
                    ep11=ep11,
                    ep21=ep21,
                    ep31=ep31,
                    ep12=ep12,
                    ep22=ep22,
                    ep32=ep32,
                )
                * (x - self.magnet_origin[0])
                / dr
            )
            BZr[zero_coords[0][0]][zero_coords[0][1]][:] = np.zeros(len(dz))
            return BZr

        else:
            return (
                self.mu0_Ms
                * self._Bzr_np(
                    r=dr,
                    Z=dz,
                    ep11=ep11,
                    ep21=ep21,
                    ep31=ep31,
                    ep12=ep12,
                    ep22=ep22,
                    ep32=ep32,
                )
                * (x - self.magnet_origin[0])
                / dr
            )

    def Bzxx_method(self, x, y, z):
        r"""Calculate magnetic field :math:`B_z` [mT].

                The magnetic field is calculated as

        .. math:
            using sympy directly calculate the derivative of Bzr

        :param float x: x coordinate of sample grid [nm]
        :param float y: y coordinate of sample grid [nm]
        :param float z: z coordinate of sample grid [nm]


        Here :math:`(x,y,z)` is the location at which we want to know the field;
        :math:`r` is the radius of the magnet; :math:`r**2 = x**2 + y**2`;
        :math 'dx = x-x_0'
        :math 'dy = y-y_0'
        :math 'dz = z-z_0'
        distances to the center of the magnet;
        :math:`\mu_0 M_s` is the magnetic sphere's saturation
        magnetization in mT.
        """

        def ellipiticPi(n, m):
            return elliprf(0.0, 1.0 - m, 1.0) + (n / 3.0) * elliprj(
                0.0, 1.0 - m, 1.0, 1.0 - n
            )

        dr = np.sqrt(
            (x - self.magnet_origin[0]) ** 2 + (y - self.magnet_origin[1]) ** 2
        )
        dz = z - self.magnet_origin[2]

        zero_coords = np.argwhere(dr == 0)

        g = (dr - self.magnet_radius) / (dr + self.magnet_radius)
        eps1 = dz + self.magnet_length / 2
        eps2 = dz - self.magnet_length / 2
        k1 = (eps1**2 + (dr - self.magnet_radius) ** 2) / (
            eps1**2 + (dr + self.magnet_radius) ** 2
        )
        k2 = (eps2**2 + (dr - self.magnet_radius) ** 2) / (
            eps2**2 + (dr + self.magnet_radius) ** 2
        )
        n = 1 - g**2

        ep11 = ellipk(1 - k1)
        ep21 = ellipe(1 - k1)
        ep31 = ellipiticPi(n, 1 - k1)

        ep12 = ellipk(1 - k2)
        ep22 = ellipe(1 - k2)
        ep32 = ellipiticPi(n, 1 - k2)

        if zero_coords.size > 0:
            dr[zero_coords[0][0]][zero_coords[0][1]][zero_coords[0][2]] = (
                x[1] - x[0]
            ) / 1000  # I still don't have a good way to approximate this point, so I just set a small difference to 0, notice that Bzxx is symmetric.
            BZxx = (
                self.mu0_Ms
                * self._Bzrr_np(
                    r=dr,
                    Z=dz,
                    ep11=ep11,
                    ep21=ep21,
                    ep31=ep31,
                    ep12=ep12,
                    ep22=ep22,
                    ep32=ep32,
                )
                * (x - self.magnet_origin[0]) ** 2
                / dr**2
                + self.mu0_Ms
                * self._Bzr_np(
                    r=dr,
                    Z=dz,
                    ep11=ep11,
                    ep21=ep21,
                    ep31=ep31,
                    ep12=ep12,
                    ep22=ep22,
                    ep32=ep32,
                )
                * ((y - self.magnet_origin[1]) ** 2)
                / dr**3
            )
            return BZxx

        else:
            return (
                self.mu0_Ms
                * self._Bzrr_np(
                    r=dr,
                    Z=dz,
                    ep11=ep11,
                    ep21=ep21,
                    ep31=ep31,
                    ep12=ep12,
                    ep22=ep22,
                    ep32=ep32,
                )
                * (x - self.magnet_origin[0]) ** 2
                / dr**2
                + self.mu0_Ms
                * self._Bzr_np(
                    r=dr,
                    Z=dz,
                    ep11=ep11,
                    ep21=ep21,
                    ep31=ep31,
                    ep12=ep12,
                    ep22=ep22,
                    ep32=ep32,
                )
                * ((y - self.magnet_origin[1]) ** 2)
                / dr**3
            )

    """_BZ_np,_Bzr_np,_Bzrr_np is terribly long, they are calculated with sympy.
    """

    def _Bz_np(self, r, Z, ep11, ep21, ep31, ep12, ep22, ep32):
        return self.magnet_radius*(-(-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/np.sqrt((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/np.sqrt((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(np.pi*(self.magnet_radius + r))

    def _Bzr_np(self, r, Z, ep11, ep21, ep31, ep12, ep22, ep32):
        return self.magnet_radius*(-(-self.magnet_length/2 + Z)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) - (-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + (-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (ep32*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - (-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/np.sqrt((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (self.magnet_length/2 + Z)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) + (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + (-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (ep31*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - (-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/np.sqrt((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(np.pi*(self.magnet_radius + r)) - self.magnet_radius*(-(-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/np.sqrt((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/np.sqrt((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(np.pi*(self.magnet_radius + r)**2)

    def _Bzrr_np(self, r, Z, ep11, ep21, ep31, ep12, ep22, ep32):
        return self.magnet_radius*(-(-self.magnet_length/2 + Z)*(-3*self.magnet_radius - 3*r)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(5/2) - 2*(-self.magnet_length/2 + Z)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep12 + ep32)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + (-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (ep32*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - (-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) + (-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) - (-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**3) - (-self.magnet_radius + r)*(-ep12 + ep32)*(-4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 + 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 + 2/(self.magnet_radius + r)**2)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - 2*(-self.magnet_radius + r)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(-(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(2*self.magnet_radius - 2*r)*(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2) - (2*self.magnet_radius + 2*r)*(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-ep12*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - ep12*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-ep12 + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2))/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(2*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)**2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep22*(2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2 - ep22*(2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) - (-ep12 + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-2*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2 - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep12*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep32*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep32*((-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + (-ep12 + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) + ((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)*(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + ((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))*(2*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2) - (self.magnet_radius + r)**2*(4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 - 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 - 2/(self.magnet_radius + r)**2)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (2*self.magnet_radius + 2*r)*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) + 2*(self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**3*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + 2*(-self.magnet_radius + r)*(-ep12 + ep32)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) + 2*(-self.magnet_radius + r)*(-(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - 2*(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)**3*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**3 - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*(-4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 + 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 + 2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - 2*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep32*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (-4*ep32*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 + 6*ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 + 2*ep32/(self.magnet_radius + r)**2 + 2*(-2*self.magnet_radius + 2*r)*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 + (-self.magnet_radius + r)**2*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep22*(2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2 - ep22*(2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) - (-ep12 + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-2*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2 - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep12*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep32*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep32*((-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + (-ep12 + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) + ((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)*(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + ((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))*(2*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2) - (self.magnet_radius + r)**2*(4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 - 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 - 2/(self.magnet_radius + r)**2)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (2*self.magnet_radius + 2*r)*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) + 2*(self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**3*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**3 - (2*self.magnet_radius - 2*r)*(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2) - (2*self.magnet_radius + 2*r)*(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-ep12*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - ep12*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-ep12 + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2))/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(2*(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)**2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - 2*(-ep12 + ep32)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - 2*(-(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + 2*(-ep12 + ep32)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/np.sqrt((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (self.magnet_length/2 + Z)*(-3*self.magnet_radius - 3*r)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(5/2) + 2*(self.magnet_length/2 + Z)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep11 + ep31)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + (-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (ep31*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - (-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) - (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) + (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**3) - (-self.magnet_radius + r)*(-ep11 + ep31)*(-4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 + 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 + 2/(self.magnet_radius + r)**2)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - 2*(-self.magnet_radius + r)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(-(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(2*self.magnet_radius - 2*r)*(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2) - (2*self.magnet_radius + 2*r)*(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-ep11*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - ep11*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-ep11 + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2))/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(2*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)**2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep21*(2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2 - ep21*(2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) - (-ep11 + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-2*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2 - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep11*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep31*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep31*((-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + (-ep11 + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) + ((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)*(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + ((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))*(2*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2) - (self.magnet_radius + r)**2*(4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 - 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 - 2/(self.magnet_radius + r)**2)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (2*self.magnet_radius + 2*r)*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) + 2*(self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**3*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + 2*(-self.magnet_radius + r)*(-ep11 + ep31)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) + 2*(-self.magnet_radius + r)*(-(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - 2*(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)**3*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**3 - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*(-4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 + 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 + 2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - 2*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep31*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (-4*ep31*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 + 6*ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 + 2*ep31/(self.magnet_radius + r)**2 + 2*(-2*self.magnet_radius + 2*r)*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 + (-self.magnet_radius + r)**2*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep21*(2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2 - ep21*(2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) - (-ep11 + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-2*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2 - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep11*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep31*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ep31*((-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + (-ep11 + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) + ((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)*(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + ((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))*(2*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 2*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 4*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))**2) - (self.magnet_radius + r)**2*(4*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**3 - 6*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**4 - 2/(self.magnet_radius + r)**2)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) - (2*self.magnet_radius + 2*r)*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))) + 2*(self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**3*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - 4*(-self.magnet_radius + r)**2*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**3 - (2*self.magnet_radius - 2*r)*(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)**2) - (2*self.magnet_radius + 2*r)*(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-(-4*self.magnet_radius - 4*r)*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**3 - 2*(-2*self.magnet_radius - 2*r)*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - 2/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)*(-ep11*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - ep11*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (-ep11 + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2) - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2))/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*(2*(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 + 2*(-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)**2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - 2*(-ep11 + ep31)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - 2*(-(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + 2*(-ep11 + ep31)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/np.sqrt((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(np.pi*(self.magnet_radius + r)) - 2*self.magnet_radius*(-(-self.magnet_length/2 + Z)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) - (-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + (-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (ep32*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep22*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep32)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep12*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep22 + ep32*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep12*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep22)*(-(-2*self.magnet_radius - 2*r)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((-self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - (-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/np.sqrt((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (self.magnet_length/2 + Z)*(-self.magnet_radius - r)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**(3/2) + (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2) - (-self.magnet_radius + r)*(-(-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)) + (-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) + (-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)**2*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)*((-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 - (ep31*(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 - 2*ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3 + (-self.magnet_radius + r)**2*((-ep21*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2) + ep31)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)) - (self.magnet_radius + r)**2*(-(-2*self.magnet_radius + 2*r)/(self.magnet_radius + r)**2 + 2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**3)*(ep11*((-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) + ep21 + ep31*((-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)**2 + ((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) - 1)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/((-self.magnet_radius + r)**2*(2*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 - 2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))))/(self.magnet_radius + r)**2 - (-ep11*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + ep21)*(-(-2*self.magnet_radius - 2*r)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)**2 - (-2*self.magnet_radius + 2*r)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))*((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2)/((-2*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)/((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + 2)*((self.magnet_length/2 + Z)**2 + (-self.magnet_radius + r)**2)))/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1) - (-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)))/np.sqrt((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(np.pi*(self.magnet_radius + r)**2) + 2*self.magnet_radius*(-(-self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep12 + ep32)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep12 + ep32*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/np.sqrt((-self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2) + (self.magnet_length/2 + Z)*(-(-self.magnet_radius + r)*(-ep11 + ep31)/((self.magnet_radius + r)*(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1)) - (-ep11 + ep31*(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2)/(-(-self.magnet_radius + r)**2/(self.magnet_radius + r)**2 + 1))/np.sqrt((self.magnet_length/2 + Z)**2 + (self.magnet_radius + r)**2))/(np.pi*(self.magnet_radius + r)**3)
